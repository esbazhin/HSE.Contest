@model IEnumerable<ResultsViewModel>

@{
    ViewData["Title"] = "Отправленные решения";
}

@section ManageGroups{
    @Html.RouteLink("Manage Groups", new { controller = "Groups", action = "Index", area = "Administration" })
}

@section ManageCodeStyle{
    @Html.RouteLink("Manage CodeStyle", new { controller = "CodeStyleRules", action = "Index", area = "Administration" })
}

<h1>Отправленные решения</h1>
<div id="app"></div>



@section Scripts{
    <script>
        let results = @Html.Raw(Json.Serialize(Model));
        new Vue({
            el: '#app',
            data: {
                results: results,
            },
            methods: {
                getValueStyle(res) {
                    if (res === 'OK' || res === 'НЕТ') {
                        return { color: '#3f8600' };
                    }
                    else {
                        return { color: '#cf1322' };
                    }
                },
                recheck(id) {
                    var http = new XMLHttpRequest();
                    var url = './ReCheckSolution';
                    var data = 'id=' + encodeURIComponent(id);
                    http.open('POST', url, true);

                    //Send the proper header information along with the request
                    http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

                    var that = this;
                    http.onreadystatechange = function () {//Call a function when the state changes.
                        if (http.readyState == 4 && http.status == 200) {
                            if (http.responseText != 'error') {
                                that.$message.success('Solution is send to recheck!');
                            }
                            else {
                                that.$message.error('An error occured. Try again!');
                            }
                        }
                    }
                    http.send(data);
                }
            },
            template: `
                <div>
                <a-list itemLayout="vertical" :dataSource="results">
                    <a-list-item slot="renderItem" slot-scope="item, index">
                            <a :href="'./ManageStudentSolutions?taskId=' + item.taskId + '&studentId=' + item.studentId" slot="actions">all solutions</a>   
                            <a :href="'./EditSolution?id=' + item.solutionId" slot="actions">edit</a> 
                            <a :href="'../Student/ViewSolutionReport?id=' + item.solutionId" slot="actions">report</a>
                            <a-popconfirm slot="actions"
                                title="Sure to recheck?"
                                @@confirm="recheck(item.solutionId)"
                                >
                                    <a-button type="link">recheck</a-button>
                            </a-popconfirm>                           
                        <a-list-item-meta>
                            <label slot="title">{{item.studentFullName}}</label>
                        </a-list-item-meta>

                        <a-row>
						    <a-col :span="8">
							   <a-statistic title="Оценка" :value="item.score"/>
						    </a-col>
						    <a-col :span="8">
							   <a-statistic title="Вердикт" :value="item.result" :value-style="getValueStyle(item.result)"/>
						    </a-col>
						    <a-col :span="8">
							    <a-statistic title="Плагиат" :value="item.plagiarismDetected ? 'ДА' : 'НЕТ'" :value-style="getValueStyle(item.plagiarismDetected ? 'ДА' : 'НЕТ')"/>
						    </a-col>						    
					    </a-row>

                    </a-list-item>
                </a-list>               
            </div>
                `,
        });
    </script>
}